var gameLogic=function(){function b(){c+=25*l;0>l&&-470>c?(c=-470,2E3>=v?w[0].style.visibility="":4E3>=v?w[1].style.visibility="":w[2].style.visibility="",n=k.result):0<l&&0<c&&(c=0,n=k.gameplay)}function m(a){n==k.gameplay&&0==u&&(1==B&&(a=0==a?1:0),a==A?(v+=10*Math.floor(p),p+=.3,30<p&&(p=30),d.correct.currentTime=0,d.correct.play(),u=8):(--p,d.wrong.currentTime=0,d.wrong.play(),u=-8))}function g(){A=.5>Math.random()?0:1;D=Math.floor(15*Math.random())}function q(a,c){return a.length>=c?a:q("0"+
a,c)}function f(){w[0].style.visibility="hidden";w[1].style.visibility="hidden";w[2].style.visibility="hidden";C=0;n=k.backToTitle}var a,d,e,E,t,r,x,y,B,p,v,A,D,u,w=Array(3),z,k={unknown:-1,slideIn:0,gameplay:1,slideOut:2,result:3,backToTitle:4},n,c,l,C;return{init:function(c,b,f,g){E=c;e=b;d=f;a=g;w[0]=document.getElementById("result0");w[1]=document.getElementById("result1");w[2]=document.getElementById("result2")},reset:function(a){y=x=r=t=0;B=a;p=30;z=u=v=0;g();l=1;c=-470;n=k.slideIn},draw:function(){switch(n){case k.slideIn:b();
break;case k.gameplay:p-=1/30;0>p&&(p=0,l=-1,c=0,n=k.slideOut);break;case k.slideOut:b();break;case k.backToTitle:C++}a.fillStyle="#cedfe7";a.fillRect(0,0,E.screenWidth,E.screenHeight);if(n==k.backToTitle){var d;a.globalAlpha=C/40;a.drawImage(e.title,0,40);a.drawImage(e.buttons,0,390,200,130,0,470,200,130);a.drawImage(e.buttons,0,260,200,130,200,470,200,130);a.globalAlpha=1;d=40==C?z:0;return d}n==k.slideIn&&a.drawImage(e.title,0,40);a.textBaseline="bottom";a.fillStyle="#000000";a.font="bold 64px Arial";
n==k.result&&(a.textAlign="center",a.fillText(v,200,180));0==A?a.drawImage(e.flowers[D],5,c+5):a.drawImage(e.bananas[D],5,c+5);a.drawImage(e.frame,0,c);0<u&&(a.drawImage(e.answere,0,0,350,350,25,70,350,350),u--,0==u&&g());0>u&&(a.drawImage(e.answere,350,0,350,350,25,70,350,350),u++,0==u&&g());n==k.result?(0==t&&0==x?a.drawImage(e.buttons,0,520,200,130,0,470,200,130):a.drawImage(e.buttons,200,520,200,130,0,470,200,130),0==r&&0==y?a.drawImage(e.buttons,0,650,200,130,200,470,200,130):a.drawImage(e.buttons,
200,650,200,130,200,470,200,130)):(0==t&&0==x?a.drawImage(e.buttons,0,0,200,130,0,470,200,130):a.drawImage(e.buttons,200,0,200,130,0,470,200,130),0==r&&0==y?a.drawImage(e.buttons,0,130,200,130,200,470,200,130):a.drawImage(e.buttons,200,130,200,130,200,470,200,130));1==B&&a.drawImage(e.mode,0,0,80,80,235,c,60,60);a.font="bold 24px Arial";a.textAlign="right";a.fillText(q(v,6),380,28+c);5>p&&(a.fillStyle="#ff0000");a.font="bold 62px Arial";a.textAlign="left";a.fillText(p.toFixed(1),20,65+c);return 0},
eventMouseMove:function(a,c){t=10<=a&&200>a&&470<c&&590>c?1:0;r=200<=a&&390>a&&470<c&&590>c?1:0},eventMouseClick:function(a){n==k.result?1==r?(z=2,f()):1==t&&(z=1,f()):1==r?m(0):1==t&&m(1)},eventKeyUp:function(a){n==k.result?(37==a.keyCode&&(z=1,x=0,f()),39==a.keyCode&&(z=2,y=0,f())):(37==a.keyCode&&(m(1),x=0),39==a.keyCode&&(m(0),y=0))},eventKeyDown:function(a){37==a.keyCode&&(x=1);39==a.keyCode&&(y=1)}}}(),loader=function(){var b,m,g,q,f;return{init:function(a,d,e){g=a;m=d;b=e},draw:function(a){b.fillStyle=
"#cedfe7";b.fillRect(0,0,g.screenWidth,g.screenHeight);b.textBaseline="bottom";b.fillStyle="#000000";b.font="14px monospace";b.textAlign="center";b.fillText(a+"%",g.screenWidth/2,355);for(var d=0;5>d;d++)a>=20*(d+1)?b.drawImage(m.bar,0,0,64,64,40+64*d,268,64,64):b.drawImage(m.bar,64,0,64,64,40+64*d,268,64,64)},resetIntro:function(a){m=a;f=q=0},drawIntro:function(){b.fillStyle="#cedfe7";b.fillRect(0,0,g.screenWidth,g.screenHeight);var a;switch(q){case 0:b.globalAlpha=1-f/40;for(a=0;5>a;a++)b.drawImage(m.bar,
0,0,64,64,40+64*a,268,64,64);b.globalAlpha=1;40==f&&(q=1,f=0);break;case 1:b.globalAlpha=40>=f?f/40:80>=f?1:1-(f-80)/40;b.textBaseline="bottom";b.fillStyle="#000000";b.font="18px \u5fae\u8edf\u6b63\u9ed1\u9ad4";b.textAlign="center";b.fillText("\u8b39\u737b\u7d66",g.screenWidth/2,g.screenHeight/2-20);b.fillText("\u70ba\u6c11\u4e3b\u633a\u8eab\u800c\u51fa\u7684\u52c7\u58eb\u5011",g.screenWidth/2,g.screenHeight/2+20);b.globalAlpha=1;120==f&&(q=2,f=0);break;case 2:b.globalAlpha=f/40,b.drawImage(m.title,
0,40),b.drawImage(m.buttons,0,390,200,130,0,470,200,130),b.drawImage(m.buttons,0,260,200,130,200,470,200,130),b.globalAlpha=1,40==f&&(q=3,f=0)}f++;return 3==q?g.mainStates.resetTitle:g.mainStates.unknown}}}(),resume=function(){function b(){var h;switch(l){case c.initial:document.getElementById("result0").style.visibility="hidden";document.getElementById("result1").style.visibility="hidden";document.getElementById("result2").style.visibility="hidden";z.src="image/BananaLoader.png";z.onload=a;t=document.getElementById("canvas");
t.width=400;t.height=600;r=t.getContext("2d");x=document.createElement("canvas");x.width=400;x.height=600;y=x.getContext("2d");t.addEventListener("mousemove",m,!0);t.addEventListener("click",g,!0);document.addEventListener("keyup",q,!0);document.addEventListener("keydown",f,!0);l=c.preloading;break;case c.preloading:r.fillStyle="#ffffff";r.fillRect(0,0,400,600);r.textBaseline="bottom";r.fillStyle="#000000";r.font="14px monospace";r.textAlign="center";r.fillText("Preparing ...",200,300);break;case c.initLoader:v.src=
"image/Title.png";v.onload=d;A.src="image/Buttons.png";A.onload=d;D.src="image/Frame.png";D.onload=d;u.src="image/Mode.png";u.onload=d;w.src="image/Answere.png";w.onload=d;k=document.createElement("audio");document.body.appendChild(k);h=k;var b="";if("probably"==h.canPlayType("audio/ogg")||"maybe"==h.canPlayType("audio/ogg"))b=".ogg";else if("probably"==h.canPlayType("audio/mp3")||"maybe"==h.canPlayType("audio/mp3"))b=".mp3";h=b;k.setAttribute("src","sound/Correct"+h);k.addEventListener("canplaythrough",
d,!1);n=document.createElement("audio");document.body.appendChild(n);n.setAttribute("src","sound/Wrong"+h);n.addEventListener("canplaythrough",d,!1);for(h=1;15>=h;h++)B[h-1]=new Image,B[h-1].src="image/Banana/"+h+".jpg",B[h-1].onload=d,p[h-1]=new Image,p[h-1].src="image/Sunflower/"+h+".jpg",p[h-1].onload=d;loader.init(H,{bar:z},y);l=c.loading;break;case c.loading:loader.draw(Math.ceil(100*I/K));e();break;case c.loadComplete:title.init(H,{buttons:A,title:v},y);gameLogic.init(H,{buttons:A,title:v,frame:D,
mode:u,answere:w,bananas:B,flowers:p},{correct:k,wrong:n},y);loader.resetIntro({bar:z,buttons:A,title:v});l=c.intro;break;case c.intro:h=loader.drawIntro();e();h!=c.unknown&&(l=c.resetTitle);break;case c.resetTitle:title.reset();l=c.title;break;case c.title:h=title.draw();e();h!=c.unknown&&(l=c.resetGame);break;case c.resetGame:gameLogic.reset(C);l=c.game;break;case c.game:h=gameLogic.draw(),e(),1==h?(C=0,l=c.resetTitle):2==h&&(C=1,l=c.resetTitle)}}function m(a){if(a.offsetX||0==a.offsetX)F=a.offsetX,
G=a.offsetY;else if(a.layerX||0==a.layerX)F=a.layerX-t.offsetLeft,G=a.layerY-t.offsetTop;switch(l){case c.title:title.eventMouseMove(F,G);break;case c.game:gameLogic.eventMouseMove(F,G)}}function g(a){switch(l){case c.title:title.eventMouseClick(a);break;case c.game:gameLogic.eventMouseClick(a)}}function q(a){if(37==a.keyCode||39==a.keyCode)switch(l){case c.title:title.eventKeyUp(a);break;case c.game:gameLogic.eventKeyUp(a)}}function f(a){if(37==a.keyCode||39==a.keyCode)switch(l){case c.title:title.eventKeyDown(a);
break;case c.game:gameLogic.eventKeyDown(a)}}function a(a){J++;J==L&&(l=c.initLoader)}function d(a){I++;I==K&&(l=c.loadComplete)}function e(){r.drawImage(x,0,0)}function E(){setInterval(b,1E3/30)}if(canvasSupport){var t,r,x,y,B=Array(15),p=Array(15),v=new Image,A=new Image,D=new Image,u=new Image,w=new Image,z=new Image,k,n,c={preloading:1,initLoader:2,loading:3,loadComplete:4,intro:5,resetTitle:6,title:7,resetGame:8,game:9},l=c.initial,C,F,G,L=1,J=0,H={mainStates:c,screenWidth:400,screenHeight:600},
K=35,I=0;return{startMessageLoop:E}}}();function canvasSupport(){return!!document.createElement("testcanvas").getContext}function eventWindowLoaded(){resume.startMessageLoop()}window.addEventListener("load",eventWindowLoaded,!1);
var title=function(){var b,m,g,q,f,a,d,e;return{init:function(a,d,e){g=a;m=d;b=e},reset:function(){e=d=a=f=q=0},draw:function(){b.fillStyle="#cedfe7";b.fillRect(0,0,g.screenWidth,g.screenHeight);b.drawImage(m.title,0,40);0==q&&0==a?b.drawImage(m.buttons,0,260,200,130,200,470,200,130):b.drawImage(m.buttons,200,260,200,130,200,470,200,130);0==f&&0==d?b.drawImage(m.buttons,0,390,200,130,0,470,200,130):b.drawImage(m.buttons,200,390,200,130,0,470,200,130);return 1==e?g.mainStates.resetGame:g.mainStates.unknown},
eventMouseMove:function(a,b){f=10<=a&&200>a&&470<b&&590>b?1:0;q=200<=a&&390>a&&470<b&&590>b?1:0},eventMouseClick:function(a){1==f&&(window.open().location="MoreInfo.html");1==q&&(e=1)},eventKeyUp:function(b){37==b.keyCode&&(d=0,window.open().location="MoreInfo.html");39==b.keyCode&&(a=0,e=1)},eventKeyDown:function(b){37==b.keyCode&&(d=1);39==b.keyCode&&(a=1)}}}();